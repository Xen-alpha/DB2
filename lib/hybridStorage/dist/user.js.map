{"version":3,"file":"user.js","sources":["../src/common.ts","../src/user.ts"],"sourcesContent":["export const STORAGE = Symbol('storage');\r\nexport const NAMESPACE = Symbol('namespace');\r\nexport const NAMESPACEE = Symbol('namespace (encode needed)');\r\nexport const PRE_ENCODED = Symbol('pre encoded');\r\nexport const ENCODE_KEY = Symbol('encode key');\r\nexport const DECODE_KEY = Symbol('decode key');\r\nexport const IS_MY_KEY = Symbol('Is it my key?');\r\n\r\nexport const propOptions = {\r\n    configurable: false,\r\n    enumerable: true,\r\n    writable: false,\r\n};\r\n\r\nexport interface KeyEncoder {\r\n    encoder(key: string): string;\r\n    decoder(key: string): string;\r\n    encodeNamespace?: boolean;\r\n    preEncodable?: boolean;\r\n}\r\n\r\nexport abstract class SyncableStorage {\r\n    protected abstract readonly [STORAGE]: unknown;\r\n    protected readonly [NAMESPACE]: string = '';\r\n    protected readonly [NAMESPACEE]: string = '';\r\n    protected readonly [PRE_ENCODED]?: boolean;\r\n\r\n    abstract readonly isRoot: boolean;\r\n    abstract readonly needRefresh: boolean;\r\n\r\n    abstract get size(): number;\r\n\r\n    abstract clear?(): PromiseLike<any>;\r\n    abstract delete(key: string): PromiseLike<any>;\r\n    abstract deleteAll(keysArg: string[], ...keys: string[]): PromiseLike<any>;\r\n    abstract forEach(\r\n        callbackfn: (value: string, key: string, map: this) => void,\r\n        thisArg?: any\r\n    ): void;\r\n    abstract get(key: string): string | null | undefined;\r\n    abstract has(key: string): boolean;\r\n    abstract hasAll(keysArr?: string[], ...keysArg: string[]): boolean;\r\n    abstract set(key: string, value: string): PromiseLike<any>;\r\n    abstract setAll(entries: Record<string, string>): PromiseLike<any>;\r\n    abstract refresh(): PromiseLike<any>;\r\n    abstract keys(): string[];\r\n    abstract values(): Record<string, string>;\r\n    abstract subset(namespace: string, keyEncoder?: KeyEncoder): SyncableStorage;\r\n    abstract copy(keyEncoder: KeyEncoder): SyncableStorage;\r\n\r\n    encodeKey?(key: string): string;\r\n    decodeKey?(key: string): string;\r\n\r\n    protected [ENCODE_KEY](key: string): string {\r\n        if (!this.encodeKey) return this[NAMESPACE] + this[NAMESPACEE] + key;\r\n        if (this[PRE_ENCODED])\r\n            return this[NAMESPACE] + this[NAMESPACEE] + this.encodeKey(key);\r\n        return this[NAMESPACE] + this.encodeKey(this[NAMESPACEE] + key);\r\n    }\r\n\r\n    protected [DECODE_KEY](key: string): string {\r\n        if (!this.decodeKey)\r\n            return key.slice(this[NAMESPACE].length + this[NAMESPACEE].length);\r\n        if (this[PRE_ENCODED])\r\n            return this.decodeKey(\r\n                key.slice(this[NAMESPACE].length + this[NAMESPACEE].length)\r\n            );\r\n        return this.decodeKey(key.slice(this[NAMESPACE].length)).slice(\r\n            this[NAMESPACEE].length\r\n        );\r\n    }\r\n\r\n    protected [IS_MY_KEY](key: string): boolean {\r\n        if (!key.startsWith(this[NAMESPACE])) return false;\r\n        key = key.slice(this[NAMESPACE].length);\r\n\r\n        if (!this.decodeKey || this[PRE_ENCODED])\r\n            return key.startsWith(this[NAMESPACEE]);\r\n        return this.decodeKey(key).startsWith(this[NAMESPACEE]);\r\n    }\r\n}\r\n","import {\r\n    SyncableStorage,\r\n    STORAGE,\r\n    KeyEncoder,\r\n    PRE_ENCODED,\r\n    propOptions,\r\n    NAMESPACE,\r\n    NAMESPACEE,\r\n    IS_MY_KEY,\r\n    ENCODE_KEY,\r\n    DECODE_KEY,\r\n} from './common';\r\n\r\nconst api = new mw.Api();\r\n\r\nconst { saveOption, saveOptions } = (() => {\r\n    let deferred = $.Deferred();\r\n    let timeout: number | null = null;\r\n\r\n    function saveOption(key: string, value: string | null) {\r\n        return saveOptions({ [key]: value });\r\n    }\r\n    function saveOptions(options: Record<string, string | null>) {\r\n        if (timeout) clearTimeout(timeout);\r\n        timeout = setTimeout(() => {\r\n            api.saveOptions(options as any).then(deferred.resolve, deferred.reject);\r\n\r\n            timeout = null;\r\n            deferred = $.Deferred();\r\n        }, 100) as any;\r\n        return deferred.promise();\r\n    }\r\n\r\n    return {\r\n        saveOption,\r\n        saveOptions,\r\n    };\r\n})();\r\n\r\nclass CloudStorage extends SyncableStorage {\r\n    isRoot: boolean;\r\n    protected readonly [STORAGE] = mw.user.options;\r\n    readonly needRefresh = true;\r\n\r\n    constructor(parent?: CloudStorage, namespace = '', keyEncoder?: KeyEncoder) {\r\n        super();\r\n\r\n        if (keyEncoder) {\r\n            if (!keyEncoder.encoder || !keyEncoder.decoder)\r\n                throw new TypeError('Encoder and decoder must be included');\r\n\r\n            this.encodeKey = keyEncoder.encoder;\r\n            this.decodeKey = keyEncoder.decoder;\r\n\r\n            if (keyEncoder.preEncodable) namespace = keyEncoder.encoder(namespace);\r\n\r\n            Object.defineProperty(this, PRE_ENCODED, {\r\n                value: keyEncoder.preEncodable,\r\n            });\r\n        }\r\n\r\n        this.isRoot = !parent;\r\n\r\n        Object.defineProperties(this, {\r\n            isRoot: propOptions,\r\n            [NAMESPACE]: {\r\n                value:\r\n                    (parent ? parent[NAMESPACE] : 'userjs-') +\r\n                    (keyEncoder ? '' : namespace),\r\n                ...propOptions,\r\n            },\r\n            [NAMESPACEE]: {\r\n                value:\r\n                    (parent ? parent[NAMESPACEE] : '') +\r\n                    (keyEncoder ? namespace : ''),\r\n                ...propOptions,\r\n            },\r\n        });\r\n    }\r\n\r\n    clear() {\r\n        if (this.isRoot) throw new TypeError('Root storage cannot be cleared');\r\n\r\n        const options: {\r\n            [key: string]: string | null;\r\n        } = {};\r\n\r\n        //@ts-ignore Access private anyway\r\n        for (const key in this[STORAGE].values) {\r\n            if (this[IS_MY_KEY](key)) options[key] = null;\r\n        }\r\n\r\n        return saveOptions(options);\r\n    }\r\n\r\n    delete(key: string) {\r\n        if (key) return saveOption(this[ENCODE_KEY](key), null);\r\n        throw new TypeError(\r\n            \"Failed to execute 'delete' on 'CloudStorage': 1 argument required, but only 0 present.\"\r\n        );\r\n    }\r\n\r\n    deleteAll(keysArg?: string[], ...keys: string[]) {\r\n        if (Array.isArray(keysArg)) keys = keysArg;\r\n        else if (!keys.length)\r\n            throw new TypeError(\r\n                \"Failed to execute 'deleteAll' on 'CloudStorage': 1 argument required, but only 0 present.\"\r\n            );\r\n\r\n        const options: Record<string, string | null> = {};\r\n\r\n        for (const key of keys) options[this[ENCODE_KEY](key)] = null;\r\n\r\n        return saveOptions(options);\r\n    }\r\n\r\n    forEach(\r\n        callbackfn: (value: string, key: string, map: this) => unknown,\r\n        thisArg?: unknown\r\n    ) {\r\n        // @ts-ignore\r\n        for (const key in this[STORAGE].values) {\r\n            if (this[IS_MY_KEY](key))\r\n                callbackfn.call(\r\n                    thisArg,\r\n                    // @ts-ignore\r\n                    this[STORAGE].values[key],\r\n                    this[DECODE_KEY](key),\r\n                    this\r\n                );\r\n        }\r\n    }\r\n\r\n    get(key: string) {\r\n        if (key) return this[STORAGE].get(this[ENCODE_KEY](key));\r\n        throw new TypeError(\r\n            \"Failed to execute 'get' on 'CloudStorage': 1 argument required, but only 0 present.\"\r\n        );\r\n    }\r\n\r\n    has(key: string) {\r\n        if (key) return this[STORAGE].exists(this[ENCODE_KEY](key));\r\n        throw new TypeError(\r\n            \"Failed to execute 'has' on 'CloudStorage': 1 argument required, but only 0 present.\"\r\n        );\r\n    }\r\n\r\n    hasAll(keysArg?: string[], ...keys: string[]): boolean {\r\n        if (keysArg) keys = keysArg;\r\n        else if (!keys.length)\r\n            throw new TypeError(\r\n                \"Failed to execute 'hasAll' on 'CloudStorage': 1 argument required, but only 0 present.\"\r\n            );\r\n\r\n        let missing = false;\r\n\r\n        for (const key of keys) {\r\n            //@ts-ignore Access private anyway\r\n            if (!(this[ENCODE_KEY](key) in this[STORAGE].values)) {\r\n                missing = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        return !missing;\r\n    }\r\n\r\n    set(key: string, value: string) {\r\n        if (key) return saveOption(this[ENCODE_KEY](key), value);\r\n        throw new TypeError(\r\n            \"Failed to execute 'set' on 'CloudStorage': 1 argument required, but only 0 present.\"\r\n        );\r\n    }\r\n\r\n    setAll(entries: Record<string, string>) {\r\n        if (entries) {\r\n            const options: Record<string, string> = {};\r\n\r\n            for (const key in entries) options[this[ENCODE_KEY](key)] = entries[key];\r\n\r\n            return saveOptions(options);\r\n        }\r\n        throw new TypeError(\r\n            \"Failed to execute 'setAll' on 'CloudStorage': 1 argument required, but only 0 present.\"\r\n        );\r\n    }\r\n\r\n    refresh = (() => {\r\n        let deferred = $.Deferred();\r\n        let timeout: number | null = null;\r\n\r\n        return () => {\r\n            if (timeout) clearTimeout(timeout);\r\n            timeout = setTimeout(() => {\r\n                api.get(\r\n                    {\r\n                        action: 'query',\r\n                        meta: 'userinfo',\r\n                        uiprop: 'options',\r\n                    },\r\n                    {\r\n                        cache: false,\r\n                    }\r\n                )\r\n                    .then((response) => {\r\n                        //@ts-ignore Access private anyway\r\n                        mw.user.options.values = response.query.userinfo.options;\r\n                        return this as CloudStorage;\r\n                    })\r\n                    .then(deferred.resolve, deferred.reject);\r\n\r\n                timeout = null;\r\n                deferred = $.Deferred();\r\n            }, 100) as any;\r\n            return deferred.promise();\r\n        };\r\n    })();\r\n\r\n    keys() {\r\n        const keys: string[] = [];\r\n\r\n        //@ts-ignore Access private anyway\r\n        for (const key in this[STORAGE].values) {\r\n            if (this[IS_MY_KEY](key)) keys.push(this[DECODE_KEY](key));\r\n        }\r\n\r\n        return keys;\r\n    }\r\n\r\n    values() {\r\n        const values: Record<string, string> = {};\r\n\r\n        //@ts-ignore Access private anyway\r\n        for (const key in this[STORAGE].values) {\r\n            if (this[IS_MY_KEY](key))\r\n                //@ts-ignore Access private anyway\r\n                values[this[DECODE_KEY](key)] = this[STORAGE].values[key];\r\n        }\r\n\r\n        return values;\r\n    }\r\n\r\n    subset(namespace: string, keyEncoder?: KeyEncoder): CloudStorage {\r\n        if (!keyEncoder && this[NAMESPACEE]) {\r\n            keyEncoder = {\r\n                encoder: this.encodeKey as any,\r\n                decoder: this.decodeKey as any,\r\n                encodeNamespace: true,\r\n                preEncodable: this[PRE_ENCODED],\r\n            };\r\n        }\r\n        if (keyEncoder && (!keyEncoder.encoder || !keyEncoder.decoder))\r\n            throw new TypeError('Encoder and decoder must be included');\r\n        return new CloudStorage(this, namespace, keyEncoder);\r\n    }\r\n\r\n    copy(keyEncoder: KeyEncoder): CloudStorage {\r\n        if (!keyEncoder)\r\n            throw new TypeError(\r\n                \"Failed to execute 'copy' on 'CloudStorage': 1 argument required, but only 0 present.\"\r\n            );\r\n        if (!keyEncoder.encoder || !keyEncoder.decoder)\r\n            throw new TypeError('Encoder and decoder must be included');\r\n\r\n        keyEncoder.encodeNamespace = false;\r\n\r\n        return new CloudStorage(this, '', keyEncoder);\r\n    }\r\n\r\n    get size() {\r\n        let count = 0;\r\n\r\n        //@ts-ignore Access private anyway\r\n        for (const key in this[STORAGE].values) {\r\n            if (this[IS_MY_KEY](key)) count++;\r\n        }\r\n\r\n        return count;\r\n    }\r\n}\r\n\r\n//@ts-ignore\r\nexport = new CloudStorage() as SyncableStorage;\r\n"],"names":["_a","_b"],"mappings":"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"}